<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ziwow.scrmapp.wechat.persistence.mapper.OpenWeixinMapper" >

	<select id="getOpenWeixin" resultType="com.ziwow.scrmapp.wechat.persistence.entity.OpenWeixin">
		select * from t_open_weixin where component_appid = #{component_appid} 
	</select>
	
	<update id="updateOpenWeixin">
		update t_open_weixin
		<set>
			<if test="component_token!=null and component_token!=''">
				component_token = #{component_token},
			</if>	
			
			<if test="component_key!=null and component_key!=''">
				component_key = #{component_key},
			</if>
			
			<if test="component_verify_ticket!=null and component_verify_ticket!=''">
				component_verify_ticket = #{component_verify_ticket},
			</if>
			
			<if test="component_access_token!=null and component_access_token!=''">
				component_access_token = #{component_access_token},
			</if>	
			update_time = now()	
		</set>
			where component_appid = #{component_appid}
	</update>
	
	<update id="updateOpenAuthorizationWeixin">
		update t_open_authorization_weixin
		<set>
			<if test="authorization_code!=null and authorization_code!=''">
				authorization_code = #{authorization_code},
			</if>	
			
			<if test="authorizer_access_token!=null and authorizer_access_token!=''">
				authorizer_access_token = #{authorizer_access_token},
			</if>
						
			<if test="authorizer_refresh_token!=null and authorizer_refresh_token!=''">
				authorizer_refresh_token = #{authorizer_refresh_token},
			</if>
			
			<if test="nick_name!=null and nick_name!=''">
				nick_name = #{nick_name},
			</if>
			<if test="func_info!=null and func_info!=''">
				func_info = #{func_info},
			</if>
			<if test="head_img!=null and head_img!=''">
				head_img = #{head_img},
			</if>
			<if test="service_type_info!=null and service_type_info!=''">
				service_type_info = #{service_type_info},
			</if>
			<if test="verify_type_info!=null and verify_type_info!=''">
				verify_type_info = #{verify_type_info},
			</if>
			<if test="user_name!=null and user_name!=''">
				user_name = #{user_name},
			</if>
			<if test="alias!=null and alias!=''">
				alias = #{alias},
			</if>	
			<if test="business_info!=null and business_info!=''">
				business_info = #{business_info},
			</if>
			<if test="qrcode_url!=null and qrcode_url!=''">
				qrcode_url = #{qrcode_url},
			</if>	
			update_time = now()	
		</set>
			where component_appid = #{component_appid} and authorizer_appid =#{authorizer_appid}
	</update>
	
	<select id="getOpenAuthorizationWeixin" resultType="com.ziwow.scrmapp.wechat.persistence.entity.OpenAuthorizationWeixin">
		select * from
		t_open_authorization_weixin
		where component_appid = #{component_appid} and authorizer_appid =#{authorizer_appid}
	</select>
	
	
	<insert id="insertOpenAuthorizationWeixin">
		insert into t_open_authorization_weixin (component_appid,authorizer_appid,authorization_code,authorizer_access_token,authorizer_refresh_token,func_info,update_time,nick_name,head_img,service_type_info,verify_type_info,user_name,alias,business_info,qrcode_url)
		values (#{component_appid},#{authorizer_appid},#{authorization_code},#{authorizer_access_token},#{authorizer_refresh_token},#{func_info},now(),#{nick_name},#{head_img},#{service_type_info},#{verify_type_info},#{user_name},#{alias},#{business_info},#{qrcode_url})
	</insert>
	
	<select id="getOpenAuthorizationWeixinByAppid" resultType="com.ziwow.scrmapp.wechat.persistence.entity.OpenAuthorizationWeixin">
		select * from
		t_open_authorization_weixin
		where authorizer_appid=#{appid} 
	</select>
	
	<select id="getOpenAuthorizationWeixinByAuthorizerUserName" resultType="com.ziwow.scrmapp.wechat.persistence.entity.OpenAuthorizationWeixin">
		select * from
		t_open_authorization_weixin
		where user_name=#{user_name} 
	</select>
	
	<delete id="deleteAuthorizerWeixinByAuthorizeAppid">
		delete from t_open_authorization_weixin
		where authorizer_appid=#{authorizer_appid} 
	</delete>
	
</mapper>